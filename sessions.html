<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sessions</title>
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/userdashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <!-- Header with Navigation -->
    <header class="header">
        <a href="#" class="logo">
            <i class="fas fa-brain"></i>
            SerenityQ
        </a>
        
        <div class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
        
        <nav class="navbar">
            <ul class="nav-links" id="navLinks">
                <li><a href="dashboard.html" class="nav-link"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="appointment.html" class="nav-link active"><i class="fas fa-calendar-alt"></i> Appointments</a></li>
                <li><a href="therapist.html" class="nav-link"><i class="fas fa-user-md"></i> Therapists</a></li>
                <li><a href="booking-history.html" class="nav-link"><i class="fas fa-history"></i> Booking History</a></li>
                <li><a href="sessions.html" class="nav-link active"><i class="fas fa-clock"></i> Sessions</a></li>
            </ul>
            
            <div class="profile">
                <span class="profile-name">Sarah</span>
                <img src="https://randomuser.me/api/portraits/women/45.jpg" class="profile-img" alt="Profile">
                <div class="dropdown-menu">
                    <a href="user-profile.html" class="dropdown-item"><i class="fas fa-user"></i> Profile</a>
                    <a href="notifications.html" class="dropdown-item"><i class="fas fa-bell"></i> Notifications</a>
                    <div class="divider"></div>
                    <a href="#" class="dropdown-item"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
<main class="session-container">

    <div class="session-layout">
        <!-- Session List -->
        <div class="session-list">
            <div class="session-tabs">
                <button class="tab-btn active" data-tab="current">Current Session</button>
                <button class="tab-btn" data-tab="previous">Previous Sessions</button>
            </div>

            <div class="session-items">
                <!-- Current Sessions Tab Content -->
                <div class="tab-content active" id="current-tab">
                    <div class="session-card active-session" data-session-id="1">
                        <div class="session-info">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Therapist" class="therapist-avatar">
                            <div class="session-details">
                                <h3>Dr. Michael Chen</h3>
                                <p class="session-method"><i class="fas fa-video"></i> Video Call</p>
                                <div class="session-timer">
                                    <i class="fas fa-clock"></i>
                                    <span id="sessionTimer">00:12:35</span>
                                </div>
                                <p class="session-time">Today, 3:00 PM - 4:00 PM</p>
                            </div>
                        </div>
                        <div class="session-status active">Active Now</div>
                    </div>
                </div>

                <!-- Previous Sessions Tab Content -->
                <div class="tab-content" id="previous-tab">
                    <div class="session-card previous-session" data-session-id="3">
                        <div class="session-info">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Therapist" class="therapist-avatar">
                            <div class="session-details">
                                <h3>Dr. Michael Chen</h3>
                                <p class="session-method"><i class="fas fa-comment"></i> Chat</p>
                                <p class="session-time">June 15, 2023</p>
                                <p class="session-duration">45 minutes</p>
                            </div>
                        </div>
                        <button class="btn request-btn" data-therapist-id="1">Request Again</button>
                    </div>

                    <div class="session-card previous-session" data-session-id="4">
                        <div class="session-info">
                            <img src="https://randomuser.me/api/portraits/women/28.jpg" alt="Therapist" class="therapist-avatar">
                            <div class="session-details">
                                <h3>Dr. Emily Wilson</h3>
                                <p class="session-method"><i class="fas fa-video"></i> Video Call</p>
                                <p class="session-time">May 28, 2023</p>
                                <p class="session-duration">60 minutes</p>
                            </div>
                        </div>
                        <button class="btn request-btn" data-therapist-id="3">Request Again</button>
                    </div>
                    
                    <div class="session-card previous-session" data-session-id="5">
                        <div class="session-info">
                            <img src="https://randomuser.me/api/portraits/women/65.jpg" alt="Therapist" class="therapist-avatar">
                            <div class="session-details">
                                <h3>Dr. Sarah Johnson</h3>
                                <p class="session-method"><i class="fas fa-phone"></i> Voice Call</p>
                                <p class="session-time">April 10, 2023</p>
                                <p class="session-duration">30 minutes</p>
                            </div>
                        </div>
                        <button class="btn request-btn" data-therapist-id="2">Request Again</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="session-chat">
            <div class="chat-placeholder">
                <div class="placeholder-content">
                    <i class="fas fa-comments fa-3x"></i>
                    <h3>Your session is ready</h3>
                    <p>Select your current session to begin your therapy session with your therapist</p>
                </div>
            </div>

            <div class="active-chat" style="display: none;">
                <div class="chat-header">
                    <div class="chat-therapist">
                        <img src="" alt="Therapist" class="therapist-avatar" id="chatTherapistAvatar">
                        <div class="therapist-info">
                            <h3 id="chatTherapistName"></h3>
                            <p class="session-method" id="chatSessionMethod"></p>
                            <div class="session-timer">
                                <i class="fas fa-clock"></i>
                                <span id="chatSessionTimer">00:12:35</span>
                            </div>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="btn action-btn minimize-chat" title="Minimize">
                            <i class="fas fa-window-minimize"></i>
                        </button>
                        <button class="btn action-btn video-call" title="Video Call">
                            <i class="fas fa-video"></i>
                        </button>
                        <button class="btn action-btn voice-call" title="Voice Call">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="btn action-btn end-session" title="End Session">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <div class="video-call-container" id="videoCallContainer" style="display: none;">
                    <div class="video-wrapper">
                        <div class="video-box local-video">
                            <video id="localVideo" autoplay muted></video>
                            <div class="video-controls">
                                <button class="btn video-control-btn toggle-video">
                                    <i class="fas fa-video"></i>
                                </button>
                                <button class="btn video-control-btn toggle-mic">
                                    <i class="fas fa-microphone"></i>
                                </button>
                            </div>
                        </div>
                        <div class="video-box remote-video">
                            <video id="remoteVideo" autoplay></video>
                            <div class="video-overlay">
                                <img src="" alt="Therapist" id="remoteVideoAvatar" class="therapist-avatar">
                                <h3 id="remoteVideoName"></h3>
                                <p id="remoteVideoStatus">Calling...</p>
                            </div>
                        </div>
                    </div>
                    <div class="call-actions">
                        <button class="btn call-action-btn end-call">
                            <i class="fas fa-phone-slash"></i>
                        </button>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be loaded here -->
                </div>

                <div class="chat-input-container">
                    <textarea id="chatInput" placeholder="Type your message here..." rows="1"></textarea>
                    <button class="btn send-btn" id="sendMessageBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <div class="previous-chat" style="display: none;">
                <div class="chat-header">
                    <div class="chat-therapist">
                        <img src="" alt="Therapist" class="therapist-avatar" id="prevTherapistAvatar">
                        <div class="therapist-info">
                            <h3 id="prevTherapistName"></h3>
                            <p class="session-method" id="prevSessionMethod"></p>
                            <p class="session-date" id="prevSessionDate"></p>
                        </div>
                    </div>
                </div>

                <div class="chat-messages" id="prevChatMessages">
                    <!-- Previous messages will be loaded here -->
                </div>

                <div class="previous-chat-footer">
                    <button class="btn request-again-btn" id="requestAgainBtn">
                        <i class="fas fa-calendar-plus"></i> Request Another Session
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Request Modal -->
<div class="modal" id="requestModal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Request New Session</h2>
        
        <div class="therapist-info-card">
            <img src="" alt="Therapist" id="modalTherapistAvatar" class="therapist-avatar">
            <div class="therapist-details">
                <h3 id="modalTherapistName">Dr. Michael Chen</h3>
                <p class="specialty">Clinical Psychologist</p>
                <div class="rating">
                    <i class="fas fa-star"></i>
                    <span>4.9</span>
                    <span class="reviews">(128 reviews)</span>
                </div>
            </div>
        </div>
        
        <form id="sessionRequestForm">
            <div class="form-group">
                <label for="sessionType">Session Type</label>
                <div class="session-type-options">
                    <label class="session-type-option">
                        <input type="radio" name="sessionType" value="video" required checked>
                        <div class="option-content">
                            <i class="fas fa-video"></i>
                            <span>Video Call</span>
                            <small>$85 per hour</small>
                        </div>
                    </label>
                    <label class="session-type-option">
                        <input type="radio" name="sessionType" value="voice">
                        <div class="option-content">
                            <i class="fas fa-phone"></i>
                            <span>Voice Call</span>
                            <small>$65 per hour</small>
                        </div>
                    </label>
                    <label class="session-type-option">
                        <input type="radio" name="sessionType" value="chat">
                        <div class="option-content">
                            <i class="fas fa-comments"></i>
                            <span>Chat</span>
                            <small>$45 per hour</small>
                        </div>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="sessionDate">Preferred Date</label>
                <input type="date" id="sessionDate" class="form-control" required min="">
            </div>

            <div class="form-group">
                <label for="sessionTime">Preferred Time</label>
                <input type="time" id="sessionTime" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="sessionNotes">Notes (Optional)</label>
                <textarea id="sessionNotes" class="form-control" rows="3" placeholder="Any specific concerns or topics you'd like to discuss..."></textarea>
            </div>

            <div class="form-actions">
                <button type="button" class="btn cancel-btn">Cancel</button>
                <button type="submit" class="btn submit-btn">Continue</button>
            </div>
        </form>
    </div>
</div>

<!-- Payment Modal -->
<div class="modal" id="paymentModal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Complete Payment</h2>
        
        <div class="payment-summary">
            <div class="payment-details">
                <h3>Session Details</h3>
                <p><strong>Therapist:</strong> <span id="paymentTherapist">Dr. Michael Chen</span></p>
                <p><strong>Session Type:</strong> <span id="paymentType">Video Call</span></p>
                <p><strong>Duration:</strong> <span id="paymentDuration">60 minutes</span></p>
                <p><strong>Date & Time:</strong> <span id="paymentDateTime">July 5, 2023 at 2:00 PM</span></p>
                <p><strong>Notes:</strong> <span id="paymentNotes">Anxiety management techniques</span></p>
            </div>

            <div class="payment-amount">
                <h3>Total Amount</h3>
                <div class="amount">$85.00</div>
                <small>Including all service fees</small>
            </div>
        </div>

        <div class="payment-methods">
            <h3>Select Payment Method</h3>
            <div class="method-options">
                <label class="method-option active">
                    <input type="radio" name="paymentMethod" value="card" checked>
                    <div class="option-content">
                        <i class="fas fa-credit-card"></i>
                        <span>Credit/Debit Card</span>
                    </div>
                </label>
                <label class="method-option">
                    <input type="radio" name="paymentMethod" value="paypal">
                    <div class="option-content">
                        <i class="fab fa-paypal"></i>
                        <span>PayPal</span>
                    </div>
                </label>
                
                <label class="method-option">
                    <input type="radio" name="paymentMethod" value="gcash">
                    <div class="option-content">
                      <!-- Inline SVG for GCash -->
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="50" height="50">
                        <!-- GCash logo SVG content -->
                      </svg>
                      <span>GCash</span>
                    </div>
                  </label>
                  <label class="method-option">
                    <input type="radio" name="paymentMethod" value="maya">
                    <div class="option-content">
                      <!-- Inline SVG for Maya -->
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="50" height="50">
                        <!-- Maya logo SVG content -->
                      </svg>
                      <span>Maya</span>
                    </div>
                  </label>
                
            </div>

            <div class="card-details" id="cardDetails">
                <div class="form-group">
                    <label for="cardNumber">Card Number</label>
                    <input type="text" id="cardNumber" class="form-control" placeholder="1234 5678 9012 3456" maxlength="19">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cardExpiry">Expiry Date</label>
                        <input type="text" id="cardExpiry" class="form-control" placeholder="MM/YY" maxlength="5">
                    </div>
                    <div class="form-group">
                        <label for="cardCVC">CVC</label>
                        <input type="text" id="cardCVC" class="form-control" placeholder="123" maxlength="3">
                    </div>
                </div>

                <div class="form-group">
                    <label for="cardName">Name on Card</label>
                    <input type="text" id="cardName" class="form-control" placeholder="John Doe">
                </div>
            </div>
            
            <div class="wallet-details" id="walletDetails" style="display: none;">
                <div class="wallet-instructions">
                    <p>You will be redirected to your wallet app to complete the payment.</p>
                    <p>Make sure you have sufficient balance in your account.</p>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="button" class="btn cancel-btn">Back</button>
            <button type="button" class="btn submit-btn" id="completePaymentBtn">Pay Now</button>
        </div>
    </div>
</div>

<!-- Payment Success Modal -->
<div class="modal" id="paymentSuccessModal">
    <div class="modal-content small">
        <div class="payment-success-content">
            <div class="icon-circle success">
                <i class="fas fa-check"></i>
            </div>
            <h2>Payment Successful</h2>
            <p>Your session request has been submitted successfully.</p>
            <div class="receipt-summary">
                <p><strong>Amount Paid:</strong> <span>$85.00</span></p>
                <p><strong>Transaction ID:</strong> <span>TX-789456123</span></p>
                <p><strong>Date:</strong> <span id="paymentDate">June 28, 2023</span></p>
            </div>
            <button type="button" class="btn ok-btn" id="paymentSuccessOkBtn">Done</button>
        </div>
    </div>
</div>

<!-- Session Ended Modal -->
<div class="modal" id="sessionEndedModal">
    <div class="modal-content small">
        <div class="session-ended-content">
            <div class="icon-circle">
                <i class="fas fa-check"></i>
            </div>
            <h2>Session Ended</h2>
            <p>Your session has been successfully completed.</p>
            <div class="session-summary">
                <p><strong>Duration:</strong> <span id="sessionDuration">47 minutes</span></p>
                <p><strong>Next Steps:</strong> <span>Review your session notes in your dashboard</span></p>
            </div>
            <button type="button" class="btn ok-btn" id="sessionEndedOkBtn">Close</button>
        </div>
    </div>
</div>

<style>
    /* Session Container Styles */
    .session-container {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
    }

    .session-layout {
        display: flex;
        gap: 20px;
        height: calc(100vh - 180px);
    }

    /* Session List Styles */
    .session-list {
        flex: 0 0 350px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .session-tabs {
        display: flex;
        border-bottom: 1px solid #eee;
        background: #f9f9f9;
    }

    .tab-btn {
        flex: 1;
        padding: 15px;
        background: none;
        border: none;
        cursor: pointer;
        font-weight: 600;
        color: var(--gray);
        position: relative;
        transition: all 0.3s;
        font-size: 0.95rem;
    }

    .tab-btn.active {
        color: var(--primary);
    }

    .tab-btn.active::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: var(--primary);
    }

    .session-items {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .session-card {
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: all 0.3s;
        border: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
    }

    .session-card:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .session-card.active {
        border-left: 4px solid var(--primary);
        background: #f5f7ff;
    }

    .session-info {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .therapist-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #f0f0f0;
    }

    .session-details h3 {
        margin: 0;
        font-size: 1rem;
        color: var(--dark);
        font-weight: 600;
    }

    .session-method {
        margin: 5px 0;
        font-size: 0.85rem;
        color: var(--gray);
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .session-time {
        margin: 0;
        font-size: 0.85rem;
        color: var(--dark);
        font-weight: 500;
    }

    .session-duration {
        margin: 0;
        font-size: 0.8rem;
        color: var(--gray);
    }

    .session-timer {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.85rem;
        color: var(--primary);
        font-weight: 600;
        margin: 5px 0;
    }

    .session-status {
        font-size: 0.8rem;
        font-weight: 600;
        padding: 6px 12px;
        border-radius: 20px;
        color: white;
        background: var(--success);
    }

    .request-btn {
        background: var(--primary);
        color: white;
        padding: 8px 15px;
        border-radius: 6px;
        font-size: 0.85rem;
        transition: all 0.2s;
    }

    .request-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
    }

    /* Chat Area Styles */
    .session-chat {
        flex: 1;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .chat-placeholder {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 30px;
        background: #f9f9f9;
    }

    .placeholder-content i {
        color: var(--primary-light);
        margin-bottom: 20px;
        opacity: 0.8;
    }

    .placeholder-content h3 {
        color: var(--dark);
        margin-bottom: 10px;
        font-size: 1.4rem;
    }

    .placeholder-content p {
        color: var(--gray);
        max-width: 400px;
        margin: 0 auto;
        font-size: 0.95rem;
        line-height: 1.5;
    }

    .active-chat, .previous-chat {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .chat-header {
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
    }

    .chat-therapist {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .therapist-info h3 {
        margin: 0;
        font-size: 1.1rem;
        color: var(--dark);
        font-weight: 600;
    }

    .therapist-info p {
        margin: 5px 0 0;
        font-size: 0.85rem;
        color: var(--gray);
    }

    .chat-actions {
        display: flex;
        gap: 10px;
    }

    .action-btn {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f0f0f0;
        color: var(--dark);
        transition: all 0.2s;
    }

    .action-btn:hover {
        transform: scale(1.1);
    }

    .action-btn.minimize-chat {
        color: var(--gray);
    }

    .action-btn.video-call {
        color: var(--primary);
    }

    .action-btn.voice-call {
        color: var(--success);
    }

    .action-btn.end-session {
        color: var(--error);
    }

    /* Video Call Styles */
    .video-call-container {
        display: none;
        flex-direction: column;
        height: 100%;
        background: #1a1a1a;
    }

    .video-wrapper {
        flex: 1;
        display: flex;
        position: relative;
        padding: 20px;
    }

    .video-box {
        border-radius: 8px;
        overflow: hidden;
        position: relative;
    }

    .local-video {
        position: absolute;
        bottom: 20px;
        right: 20px;
        width: 25%;
        min-width: 200px;
        z-index: 10;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .remote-video {
        width: 100%;
        height: 100%;
        background: #333;
    }

    video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .video-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        background: rgba(0, 0, 0, 0.5);
    }

    .video-overlay img {
        width: 80px;
        height: 80px;
        margin-bottom: 15px;
    }

    .video-overlay h3 {
        margin: 0;
        font-size: 1.2rem;
    }

    .video-overlay p {
        margin: 5px 0 0;
        font-size: 0.9rem;
        opacity: 0.8;
    }

    .video-controls {
        position: absolute;
        bottom: 10px;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 10px;
        padding: 10px;
    }

    .video-control-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
    }

    .video-control-btn:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    .call-actions {
        padding: 15px;
        display: flex;
        justify-content: center;
        background: rgba(0, 0, 0, 0.3);
    }

    .call-action-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--error);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
    }

    .call-action-btn:hover {
        transform: scale(1.1);
    }

    /* Chat Messages Styles */
    .chat-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: #f5f5f5;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .message {
        max-width: 100%;
        display: flex;
        flex-direction: column;
    }

    .message.received {
        align-items: flex-start;
    }

    .message.sent {
        align-items: flex-end;
    }

    .message-content {
        padding: 12px 16px;
        border-radius: 18px;
        position: relative;
        word-wrap: break-word;
        line-height: 1.4;
    }

    .message.received .message-content {
        background: white;
        border-top-left-radius: 5px;
        color: var(--dark);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .message.sent .message-content {
        background: var(--primary);
        color: white;
        border-top-right-radius: 5px;
    }

    .message-info {
        margin-top: 5px;
        font-size: 0.75rem;
        color: var(--gray);
    }

    .chat-input-container {
        padding: 15px;
        border-top: 1px solid #eee;
        display: flex;
        gap: 10px;
        align-items: center;
        background: white;
    }

    .chat-input-container textarea {
        flex: 1;
        border: 1px solid #ddd;
        border-radius: 20px;
        padding: 12px 15px;
        resize: none;
        max-height: 100px;
        outline: none;
        transition: all 0.3s;
        font-size: 0.95rem;
    }

    .chat-input-container textarea:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(70, 90, 255, 0.1);
    }

    .send-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: var(--primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
    }

    .send-btn:hover {
        background: var(--primary-dark);
        transform: scale(1.05);
    }

    .send-btn:active {
        transform: scale(0.95);
    }

    .previous-chat-footer {
        padding: 15px;
        border-top: 1px solid #eee;
        text-align: center;
        background: white;
    }

    .request-again-btn {
        background: var(--primary);
        color: white;
        padding: 12px 25px;
        border-radius: 6px;
        font-weight: 600;
        transition: all 0.2s;
    }

    .request-again-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(70, 90, 255, 0.2);
    }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .modal-content {
        background: white;
        border-radius: 12px;
        width: 100%;
        max-width: 700px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        animation: modalSlideUp 0.3s;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    @keyframes modalSlideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .modal-content.small {
        max-width: 400px;
    }

    .modal-content h2 {
        margin: 0;
        padding: 20px;
        color: var(--dark);
        font-size: 1.5rem;
        border-bottom: 1px solid #eee;
    }

    .close-modal {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--gray);
        background: none;
        border: none;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
    }

    .close-modal:hover {
        color: var(--dark);
        background: #f0f0f0;
    }

    /* Therapist Info Card in Modal */
    .therapist-info-card {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 20px;
        border-bottom: 1px solid #eee;
    }

    .therapist-details h3 {
        margin: 0;
        font-size: 1.1rem;
        color: var(--dark);
    }

    .specialty {
        margin: 5px 0;
        font-size: 0.9rem;
        color: var(--gray);
    }

    .rating {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.9rem;
        color: var(--dark);
    }

    .rating i {
        color: #ffc107;
    }

    .reviews {
        color: var(--gray);
        font-size: 0.8rem;
    }

    /* Form Styles */
    .form-group {
        margin-bottom: 20px;
        padding: 0 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--dark);
        font-size: 0.95rem;
    }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(70, 90, 255, 0.1);
    }

    .form-row {
        display: flex;
        gap: 15px;
    }

    .form-row .form-group {
        flex: 1;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        padding: 20px;
        border-top: 1px solid #eee;
    }

    .cancel-btn {
        background: #f0f0f0;
        color: var(--dark);
        padding: 12px 20px;
        border-radius: 6px;
        font-weight: 600;
        transition: all 0.2s;
    }

    .cancel-btn:hover {
        background: #e0e0e0;
    }

    .submit-btn {
        background: var(--primary);
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        font-weight: 600;
        transition: all 0.2s;
    }

    .submit-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(70, 90, 255, 0.2);
    }

    /* Session Type Options */
    .session-type-options {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }

    .session-type-option {
        flex: 1;
    }

    .session-type-option input {
        display: none;
    }

    .session-type-option .option-content {
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        height: 100%;
    }

    .session-type-option i {
        font-size: 1.5rem;
        color: var(--primary);
        margin-bottom: 10px;
    }

    .session-type-option span {
        display: block;
        font-weight: 600;
        color: var(--dark);
    }

    .session-type-option small {
        display: block;
        font-size: 0.8rem;
        color: var(--gray);
        margin-top: 5px;
    }

    .session-type-option input:checked + .option-content {
        border-color: var(--primary);
        background: #f5f7ff;
    }

    /* Payment Styles */
    .payment-summary {
        display: flex;
        gap: 20px;
        padding: 20px;
        border-bottom: 1px solid #eee;
    }

    .payment-details {
        flex: 2;
    }

    .payment-details h3 {
        margin-top: 0;
        color: var(--dark);
        font-size: 1.1rem;
    }

    .payment-details p {
        margin: 8px 0;
        color: var(--gray);
        font-size: 0.95rem;
    }

    .payment-details strong {
        color: var(--dark);
        font-weight: 600;
    }

    .payment-amount {
        flex: 1;
        text-align: center;
        padding: 15px;
        background: #f9f9f9;
        border-radius: 10px;
    }

    .payment-amount h3 {
        margin-top: 0;
        color: var(--dark);
        font-size: 1.1rem;
    }

    .amount {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary);
        margin: 10px 0;
    }

    .payment-methods {
        padding: 20px;
    }

    .payment-methods h3 {
        margin-top: 0;
        color: var(--dark);
        font-size: 1.1rem;
    }

    .method-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 15px 0;
    }

    .method-option {
        flex: 1;
        min-width: 120px;
    }

    .method-option input {
        display: none;
    }

    .method-option .option-content {
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        height: 100%;
    }

    .method-option i {
        font-size: 1.5rem;
        margin-bottom: 10px;
        color: var(--primary);
    }

    .method-option .payment-icon {
        height: 24px;
        margin-bottom: 10px;
    }

    .method-option.active .option-content {
        border-color: var(--primary);
        background: #f5f7ff;
    }

    .card-details {
        margin-top: 20px;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 10px;
    }

    .wallet-details {
        margin-top: 20px;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 10px;
    }

    .wallet-instructions {
        background: white;
        padding: 15px;
        border-radius: 8px;
        font-size: 0.9rem;
        color: var(--gray);
    }

    .wallet-instructions p {
        margin: 5px 0;
    }

    /* Success Modal Styles */
    .payment-success-content, .session-ended-content {
        text-align: center;
        padding: 30px;
    }

    .icon-circle {
        width: 80px;
        height: 80px;
        background: var(--success);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
    }

    .icon-circle.success {
        background: var(--success);
    }

    .icon-circle i {
        color: white;
        font-size: 2rem;
    }

    .payment-success-content h2, .session-ended-content h2 {
        color: var(--dark);
        margin-bottom: 10px;
    }

    .payment-success-content p, .session-ended-content p {
        color: var(--gray);
        margin-bottom: 20px;
    }

    .receipt-summary, .session-summary {
        text-align: left;
        margin: 20px 0;
        padding: 15px;
        background: #f9f9f9;
        border-radius: 8px;
    }

    .receipt-summary p, .session-summary p {
        margin: 8px 0;
        color: var(--gray);
        display: flex;
        justify-content: space-between;
    }

    .receipt-summary strong, .session-summary strong {
        color: var(--dark);
    }

    .ok-btn {
        background: var(--primary);
        color: white;
        padding: 12px 30px;
        border-radius: 6px;
        font-weight: 600;
        transition: all 0.2s;
    }

    .ok-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(70, 90, 255, 0.2);
    }

    /* Responsive Styles */
    @media (max-width: 992px) {
        .session-layout {
            flex-direction: column;
            height: auto;
        }

        .session-list {
            flex: 1;
            margin-bottom: 20px;
        }
        
        .payment-summary {
            flex-direction: column;
        }
    }

    @media (max-width: 768px) {
        .session-container {
            padding: 15px;
        }
        
        .session-type-options {
            flex-direction: column;
        }
        
        .method-options {
            flex-direction: column;
        }
    }

    @media (max-width: 576px) {
        .session-tabs {
            flex-direction: column;
        }

        .tab-btn {
            padding: 12px;
            text-align: center;
        }

        .tab-btn.active::after {
            height: 2px;
            width: 100%;
        }
        
        .form-row {
            flex-direction: column;
            gap: 0;
        }
        
        .video-wrapper {
            flex-direction: column;
        }
        
        .local-video {
            position: relative;
            width: 100%;
            margin-bottom: 10px;
        }
    }
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab Switching
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            
            // Update active tab button
            tabBtns.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Show corresponding tab content
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabId}-tab`) {
                    content.classList.add('active');
                }
            });
            
            // Reset chat view when switching tabs
            resetChatView();
        });
    });
    
    // Session Card Selection
    const sessionCards = document.querySelectorAll('.session-card');
    const chatPlaceholder = document.querySelector('.chat-placeholder');
    const activeChat = document.querySelector('.active-chat');
    const previousChat = document.querySelector('.previous-chat');
    
    sessionCards.forEach(card => {
        card.addEventListener('click', function() {
            // Remove active class from all cards
            sessionCards.forEach(c => c.classList.remove('active'));
            
            // Add active class to clicked card
            this.classList.add('active');
            
            // Check if it's a current/active session or previous session
            if (this.classList.contains('active-session')) {
                // Show active chat interface
                loadActiveSession(this);
                chatPlaceholder.style.display = 'none';
                activeChat.style.display = 'flex';
                previousChat.style.display = 'none';
            } else if (this.classList.contains('previous-session')) {
                // Show previous chat interface
                loadPreviousSession(this);
                chatPlaceholder.style.display = 'none';
                activeChat.style.display = 'none';
                previousChat.style.display = 'flex';
            }
        });
    });
    
    function loadActiveSession(card) {
        const therapistAvatar = card.querySelector('.therapist-avatar').src;
        const therapistName = card.querySelector('.session-details h3').textContent;
        const sessionMethod = card.querySelector('.session-method').textContent;
        const sessionTimer = card.querySelector('.session-timer span').textContent;
        
        document.getElementById('chatTherapistAvatar').src = therapistAvatar;
        document.getElementById('chatTherapistName').textContent = therapistName;
        document.getElementById('chatSessionMethod').textContent = sessionMethod;
        document.getElementById('chatSessionTimer').textContent = sessionTimer;
        
        // For video call overlay
        document.getElementById('remoteVideoAvatar').src = therapistAvatar;
        document.getElementById('remoteVideoName').textContent = therapistName;
        
        // Load messages for this session
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.innerHTML = '';
        
        // Sample messages
        const messages = [
            { sender: 'therapist', text: 'Hello Sarah, how are you feeling today?', time: '3:00 PM' },
            { sender: 'user', text: 'Hi Dr. Chen, I\'m feeling a bit anxious about my upcoming presentation.', time: '3:02 PM' },
            { sender: 'therapist', text: 'I understand. Let\'s talk through some strategies to manage that anxiety.', time: '3:04 PM' }
        ];
        
        messages.forEach(msg => {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${msg.sender === 'user' ? 'sent' : 'received'}`;
            
            messageDiv.innerHTML = `
                <div class="message-content">${msg.text}</div>
                <div class="message-info">${msg.time}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
        });
        
        // Scroll to bottom of chat
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    function loadPreviousSession(card) {
        const therapistAvatar = card.querySelector('.therapist-avatar').src;
        const therapistName = card.querySelector('.session-details h3').textContent;
        const sessionMethod = card.querySelector('.session-method').textContent;
        const sessionDate = card.querySelector('.session-time').textContent;
        
        document.getElementById('prevTherapistAvatar').src = therapistAvatar;
        document.getElementById('prevTherapistName').textContent = therapistName;
        document.getElementById('prevSessionMethod').textContent = sessionMethod;
        document.getElementById('prevSessionDate').textContent = sessionDate;
        
        // Load previous messages for this session
        const prevChatMessages = document.getElementById('prevChatMessages');
        prevChatMessages.innerHTML = '';
        
        // Sample previous messages
        const prevMessages = [
            { sender: 'therapist', text: 'Welcome back Sarah. How have you been since our last session?', time: 'June 15, 3:00 PM' },
            { sender: 'user', text: 'Thanks Dr. Chen. I\'ve been better at recognizing my anxiety triggers.', time: 'June 15, 3:02 PM' },
            { sender: 'therapist', text: 'That\'s great progress! What strategies have been working for you?', time: 'June 15, 3:04 PM' },
            { sender: 'user', text: 'The breathing exercises have helped, especially before meetings.', time: 'June 15, 3:06 PM' },
            { sender: 'therapist', text: 'I\'m glad to hear that. Let\'s explore some additional techniques today.', time: 'June 15, 3:08 PM' }
        ];
        
        prevMessages.forEach(msg => {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${msg.sender === 'user' ? 'sent' : 'received'}`;
            
            messageDiv.innerHTML = `
                <div class="message-content">${msg.text}</div>
                <div class="message-info">${msg.time}</div>
            `;
            
            prevChatMessages.appendChild(messageDiv);
        });
        
        // Scroll to bottom of chat
        prevChatMessages.scrollTop = prevChatMessages.scrollHeight;
    }
    
    function resetChatView() {
        chatPlaceholder.style.display = 'flex';
        activeChat.style.display = 'none';
        previousChat.style.display = 'none';
        
        // Remove active class from all session cards
        sessionCards.forEach(card => card.classList.remove('active'));
        
        // Hide video call if open
        document.getElementById('videoCallContainer').style.display = 'none';
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.style.display = 'block';
    }
    
    // Timer Simulation
    function updateTimer() {
        const timerElements = document.querySelectorAll('.session-timer span');
        let time = 753; // 12 minutes 33 seconds in seconds
        
        setInterval(() => {
            time++;
            const minutes = Math.floor(time / 60);
            const seconds = time % 60;
            const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            timerElements.forEach(el => {
                el.textContent = formattedTime;
            });
        }, 1000);
    }
    
    updateTimer();
    
    // Modal Handling
    const modals = document.querySelectorAll('.modal');
    const closeModalBtns = document.querySelectorAll('.close-modal, .cancel-btn');
    const requestModal = document.getElementById('requestModal');
    const paymentModal = document.getElementById('paymentModal');
    const paymentSuccessModal = document.getElementById('paymentSuccessModal');
    const sessionEndedModal = document.getElementById('sessionEndedModal');
    
    // Function to open modal
    function openModal(modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
    
    // Function to close modal
    function closeModal(modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    
    // Close modals when clicking on close button or cancel
    closeModalBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const modal = this.closest('.modal');
            closeModal(modal);
        });
    });
    
    // Close modals when clicking outside
    window.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal')) {
            closeModal(e.target);
        }
    });
    
    // Close modals with escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            modals.forEach(modal => {
                if (modal.style.display === 'flex') {
                    closeModal(modal);
                }
            });
        }
    });
    
    // Request Again Button
    const requestAgainBtn = document.getElementById('requestAgainBtn');
    
    requestAgainBtn.addEventListener('click', function() {
        const therapistName = document.getElementById('prevTherapistName').textContent;
        const therapistAvatar = document.getElementById('prevTherapistAvatar').src;
        
        document.getElementById('modalTherapistName').textContent = therapistName;
        document.getElementById('modalTherapistAvatar').src = therapistAvatar;
        
        openModal(requestModal);
        
        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('sessionDate').min = today;
    });
    
    // Request Again from Previous Session Card
    const requestBtns = document.querySelectorAll('.request-btn');
    
    requestBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            const card = this.closest('.session-card');
            const therapistName = card.querySelector('h3').textContent;
            const therapistAvatar = card.querySelector('.therapist-avatar').src;
            
            document.getElementById('modalTherapistName').textContent = therapistName;
            document.getElementById('modalTherapistAvatar').src = therapistAvatar;
            
            openModal(requestModal);
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('sessionDate').min = today;
        });
    });
    
    // Session Request Form Submission
    const sessionRequestForm = document.getElementById('sessionRequestForm');
    
    sessionRequestForm.addEventListener('submit', function(e) {
        e.preventDefault();
        closeModal(requestModal);
        showPaymentModal();
    });
    
    function showPaymentModal() {
        // Get selected values
        const therapistName = document.getElementById('modalTherapistName').textContent;
        const sessionType = document.querySelector('input[name="sessionType"]:checked').value;
        const sessionDate = document.getElementById('sessionDate').value;
        const sessionTime = document.getElementById('sessionTime').value;
        const sessionNotes = document.getElementById('sessionNotes').value;
        
        // Format session type
        let typeText = '';
        let price = '';
        switch(sessionType) {
            case 'video':
                typeText = 'Video Call';
                price = '$85.00';
                break;
            case 'voice':
                typeText = 'Voice Call';
                price = '$65.00';
                break;
            case 'chat':
                typeText = 'Chat Session';
                price = '$45.00';
                break;
        }
        
        // Format date
        const dateObj = new Date(sessionDate);
        const formattedDate = dateObj.toLocaleDateString('en-US', { 
            month: 'long', 
            day: 'numeric', 
            year: 'numeric' 
        });
        
        document.getElementById('paymentTherapist').textContent = therapistName;
        document.getElementById('paymentType').textContent = typeText;
        document.getElementById('paymentDuration').textContent = '60 minutes';
        document.getElementById('paymentDateTime').textContent = `${formattedDate} at ${sessionTime}`;
        document.getElementById('paymentNotes').textContent = sessionNotes || 'None';
        document.querySelector('.amount').textContent = price;
        
        openModal(paymentModal);
    }
    
    // Payment Method Selection
    const methodOptions = document.querySelectorAll('.method-option');
    
    methodOptions.forEach(option => {
        option.addEventListener('click', function() {
            methodOptions.forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');
            
            // Show corresponding payment details
            const method = this.querySelector('input').value;
            document.getElementById('cardDetails').style.display = 
                method === 'card' ? 'block' : 'none';
            document.getElementById('walletDetails').style.display = 
                method !== 'card' ? 'block' : 'none';
        });
    });
    
    // Format card number input
    const cardNumberInput = document.getElementById('cardNumber');
    cardNumberInput.addEventListener('input', function(e) {
        let value = this.value.replace(/\s+/g, '');
        if (value.length > 16) value = value.substr(0, 16);
        
        let formattedValue = '';
        for (let i = 0; i < value.length; i++) {
            if (i > 0 && i % 4 === 0) formattedValue += ' ';
            formattedValue += value[i];
        }
        
        this.value = formattedValue;
    });
    
    // Format expiry date input
    const cardExpiryInput = document.getElementById('cardExpiry');
    cardExpiryInput.addEventListener('input', function(e) {
        let value = this.value.replace(/\D+/g, '');
        if (value.length > 2) {
            value = value.substr(0, 2) + '/' + value.substr(2, 2);
        }
        this.value = value;
    });
    
    // Complete Payment Button
    const completePaymentBtn = document.getElementById('completePaymentBtn');
    
    completePaymentBtn.addEventListener('click', function() {
        closeModal(paymentModal);
        
        // Set current date in success modal
        const today = new Date();
        const formattedDate = today.toLocaleDateString('en-US', { 
            month: 'long', 
            day: 'numeric', 
            year: 'numeric' 
        });
        document.getElementById('paymentDate').textContent = formattedDate;
        
        openModal(paymentSuccessModal);
    });
    
    // Payment Success OK Button
    const paymentSuccessOkBtn = document.getElementById('paymentSuccessOkBtn');
    
    paymentSuccessOkBtn.addEventListener('click', function() {
        closeModal(paymentSuccessModal);
    });
    
    // Session Ended OK Button
    const sessionEndedOkBtn = document.getElementById('sessionEndedOkBtn');
    
    sessionEndedOkBtn.addEventListener('click', function() {
        closeModal(sessionEndedModal);
    });
    
    // Chat Input Functionality
    const chatInput = document.getElementById('chatInput');
    const sendMessageBtn = document.getElementById('sendMessageBtn');
    
    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
    
    sendMessageBtn.addEventListener('click', sendMessage);
    
    function sendMessage() {
        const messageText = chatInput.value.trim();
        if (messageText) {
            const chatMessages = document.getElementById('chatMessages');
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message sent';
            
            messageDiv.innerHTML = `
                <div class="message-content">${messageText}</div>
                <div class="message-info">${timeString}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatInput.value = '';
            
            // Reset textarea height
            chatInput.style.height = 'auto';
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Simulate therapist reply after a delay
            setTimeout(() => {
                const replies = [
                    "I understand how that might make you feel.",
                    "That's an important observation. Can you tell me more?",
                    "Let's explore that feeling together.",
                    "How does that make you feel?",
                    "Thank you for sharing that with me."
                ];
                
                const randomReply = replies[Math.floor(Math.random() * replies.length)];
                
                const replyDiv = document.createElement('div');
                replyDiv.className = 'message received';
                
                replyDiv.innerHTML = `
                    <div class="message-content">${randomReply}</div>
                    <div class="message-info">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
                `;
                
                chatMessages.appendChild(replyDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000 + Math.random() * 2000);
        }
    }
    
    // Auto-resize textarea
    chatInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
    
    // Video Call Functionality
    const videoCallBtn = document.querySelector('.video-call');
    const voiceCallBtn = document.querySelector('.voice-call');
    const endSessionBtn = document.querySelector('.end-session');
    const minimizeBtn = document.querySelector('.minimize-chat');
    const videoCallContainer = document.getElementById('videoCallContainer');
    const chatMessagesContainer = document.getElementById('chatMessages');
    const endCallBtn = document.querySelector('.end-call');
    const toggleVideoBtn = document.querySelector('.toggle-video');
    const toggleMicBtn = document.querySelector('.toggle-mic');
    
    videoCallBtn.addEventListener('click', function() {
        // Show video call container
        videoCallContainer.style.display = 'flex';
        chatMessagesContainer.style.display = 'none';
        
        // Simulate call connection
        setTimeout(() => {
            document.getElementById('remoteVideoStatus').textContent = 'Connected';
            document.querySelector('.video-overlay').style.display = 'none';
            document.getElementById('remoteVideo').style.display = 'block';
        }, 1500);
        
        // Get user media for local video
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                .then(function(stream) {
                    const localVideo = document.getElementById('localVideo');
                    localVideo.srcObject = stream;
                })
                .catch(function(error) {
                    console.error('Error accessing media devices:', error);
                });
        }
    });
    
    voiceCallBtn.addEventListener('click', function() {
        alert('Voice call initiated. This would connect to your therapist in a real application.');
    });
    
    endSessionBtn.addEventListener('click', function() {
        openModal(sessionEndedModal);
        
        // Stop any ongoing video stream
        const localVideo = document.getElementById('localVideo');
        if (localVideo.srcObject) {
            localVideo.srcObject.getTracks().forEach(track => track.stop());
        }
        
        // Reset chat view
        resetChatView();
    });
    
    minimizeBtn.addEventListener('click', function() {
        resetChatView();
    });
    
    endCallBtn.addEventListener('click', function() {
        // Hide video call container
        videoCallContainer.style.display = 'none';
        chatMessagesContainer.style.display = 'block';
        
        // Stop video stream
        const localVideo = document.getElementById('localVideo');
        if (localVideo.srcObject) {
            localVideo.srcObject.getTracks().forEach(track => track.stop());
            localVideo.srcObject = null;
        }
        
        // Reset overlay for next call
        document.getElementById('remoteVideoStatus').textContent = 'Calling...';
        document.querySelector('.video-overlay').style.display = 'flex';
        document.getElementById('remoteVideo').style.display = 'none';
    });
    
    toggleVideoBtn.addEventListener('click', function() {
        const localVideo = document.getElementById('localVideo');
        if (localVideo.srcObject) {
            const videoTrack = localVideo.srcObject.getVideoTracks()[0];
            if (videoTrack) {
                videoTrack.enabled = !videoTrack.enabled;
                this.classList.toggle('disabled');
            }
        }
    });
    
    toggleMicBtn.addEventListener('click', function() {
        const localVideo = document.getElementById('localVideo');
        if (localVideo.srcObject) {
            const audioTrack = localVideo.srcObject.getAudioTracks()[0];
            if (audioTrack) {
                audioTrack.enabled = !audioTrack.enabled;
                this.classList.toggle('disabled');
            }
        }
    });
});
    
</script>

    <script src="js/activeLink.js"></script>
    <script src="js/userdashboard.js"></script> 
</body>
</html>