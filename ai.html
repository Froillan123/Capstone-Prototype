<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SerenityQ AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/userdashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        :root {
            --primary: #5d5fef;
            --primary-dark: #4a4cbf;
            --secondary: #6c757d;
            --light: #f8f9fa;
            --dark: #343a40;
            --border: #e9ecef;
            --gray: #adb5bd;
            --accent: #ffc107;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #fd7e14;
            --info: #17a2b8;
            --sidebar-width: 280px;
        }


        body {
            overflow-x: hidden;
            background-color: #f5f7fb;
            color: #333;
            padding-top: 80px;
        }

        /* Add this to your existing CSS */
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .logo i {
            margin-right: 10px;
            font-size: 1.8rem;
        }


        /* Main Chat Container */
        .chat-container {
            display: flex;
            height: calc(100vh - 80px);
            width: 100%;
            margin: 0 auto;
            background-color: white;
            position: relative;
        }

        .chat-history {
            width: 300px;
            background-color: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            transform: translateX(0); /* Show by default */
            position: relative; /* Change from fixed to relative */
            top: 0;
            height: calc(100vh - 80px);
        }

        /* For mobile view */
        @media (max-width: 992px) {
            .chat-history {
                position: fixed;
                transform: translateX(-100%);
                z-index: 100;
            }
            
            .chat-history.active {
                transform: translateX(0);
            }
            
            .chat-area {
                margin-left: 0;
            }
            
            .chat-area.with-sidebar {
                margin-left: 0;
            }
        }

        .chat-history.active {
            transform: translateX(0);
        }

        .chat-history-header {
            padding: 15px 20px;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-history-header i {
            color: var(--primary);
            cursor: pointer;
        }

        .new-chat-btn {
            padding: 12px 15px;
            margin: 15px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            box-shadow: 0 3px 10px rgba(93, 95, 239, 0.3);
            font-size: 0.9rem;
        }

        .new-chat-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .new-chat-btn i {
            margin-right: 8px;
        }

        .history-title {
            padding: 10px 20px;
            font-size: 0.9rem;
            color: var(--gray);
            border-bottom: 1px solid var(--border);
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 5px 0;
        }

        .history-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }

        .history-item:hover {
            background-color: rgba(93, 95, 239, 0.05);
        }

        .history-item.active {
            background-color: rgba(93, 95, 239, 0.1);
            border-left: 3px solid var(--primary);
        }

        .history-item i {
            margin-right: 10px;
            color: var(--gray);
        }

        .history-item-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        /* Main Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background-color: #f5f7fb;
            margin-left: 0;
            transition: margin-left 0.3s ease;
        }

        .chat-area.with-sidebar {
            margin-left: var(--sidebar-width);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
        }

        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 12px;
            line-height: 1.5;
            position: relative;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-message {
            align-self: flex-start;
            background-color: white;
            border-bottom-left-radius: 5px;
            border: 1px solid var(--border);
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--primary);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message-content p {
            margin-bottom: 5px;
        }

        .message-time {
            font-size: 0.7rem;
            color: var(--gray);
            text-align: right;
            margin-top: 5px;
        }

        .user-message .message-time {
            color: rgba(255, 255, 255, 0.7);
        }

        .user-input-container {
            padding: 15px 20px;
            position: sticky;
            bottom: 0;
        }

        .user-input-box {
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 25px;
            padding: 8px 15px;
            border: 2px solid var(--gray);
            transition: all 0.3s;
            margin: 0 auto;
            width: 100%;
        }

        .user-input-box:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(93, 95, 239, 0.2);
        }

        .user-input-box textarea {
            flex: 1;
            border: none;
            background: transparent;
            resize: none;
            padding: 8px;
            font-size: 1rem;
            max-height: 150px;
            outline: none;
            line-height: 1.5;
        }

        .send-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px 10px;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .send-btn:hover {
            background-color: rgba(93, 95, 239, 0.1);
            transform: scale(1.1);
        }

        /* Therapist Cards */
        .therapist-cards {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .therapist-card {
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            transition: all 0.3s;
            cursor: pointer;
            background-color: white;
        }

        .therapist-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .therapist-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .therapist-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .therapist-info {
            flex: 1;
        }

        .therapist-info h4 {
            margin: 0 0 5px;
            color: var(--dark);
            font-size: 1rem;
        }

        .specialty {
            font-size: 0.8rem;
            color: var(--secondary);
            margin-bottom: 5px;
        }

        .rating {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .rating i {
            color: var(--accent);
            font-size: 0.8rem;
            margin-right: 2px;
        }

        .rating span {
            font-size: 0.8rem;
            color: var(--gray);
            margin-left: 5px;
        }

        .price {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            transform: translateY(-20px);
            transition: all 0.3s;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 10;
        }

        .modal-title {
            font-size: 1.3rem;
            color: var(--dark);
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: all 0.2s;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal-body {
            padding: 20px;
        }

        .therapist-profile {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .therapist-profile-img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            flex-shrink: 0;
        }

        .therapist-profile-info h3 {
            margin-bottom: 5px;
            color: var(--dark);
        }

        .therapist-profile-specialty {
            color: var(--primary);
            font-weight: 500;
            margin-bottom: 10px;
        }

        .therapist-profile-rating {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .therapist-profile-rating i {
            color: var(--accent);
            margin-right: 5px;
        }

        .therapist-profile-price {
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .therapist-profile-about {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .therapist-specialties {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .specialty-badge {
            background-color: rgba(93, 95, 239, 0.1);
            color: var(--primary);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .booking-section {
            margin-top: 20px;
            border-top: 1px solid var(--border);
            padding-top: 20px;
        }

        .booking-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 95, 239, 0.2);
        }

        .payment-methods {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .payment-method {
            flex: 1;
            min-width: 120px;
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: 10px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-method:hover {
            border-color: var(--primary);
        }

        .payment-method.active {
            border-color: var(--primary);
            background-color: rgba(93, 95, 239, 0.05);
        }

        .payment-method i {
            font-size: 1.5rem;
            margin-right: 10px;
            color: var(--primary);
        }

        .payment-method-info h5 {
            margin: 0;
            font-size: 0.9rem;
        }

        .payment-method-info p {
            margin: 0;
            font-size: 0.8rem;
            color: var(--gray);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--border);
            color: var(--dark);
        }

        .btn-outline:hover {
            background-color: var(--light);
        }

        .btn i {
            margin-right: 8px;
        }

        .booking-success {
            text-align: center;
            padding: 30px;
        }

        .booking-success i {
            font-size: 3rem;
            color: var(--success);
            margin-bottom: 20px;
        }

        .booking-success h3 {
            margin-bottom: 10px;
            color: var(--success);
        }

        .booking-success p {
            margin-bottom: 20px;
            color: var(--secondary);
        }

        /* Booking Steps */
        .booking-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            position: relative;
        }

        .booking-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--border);
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--light);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 5px;
            transition: all 0.3s;
        }

        .step.active .step-number {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .step.completed .step-number {
            background-color: var(--success);
            border-color: var(--success);
            color: white;
        }

        .step-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .step.active .step-label {
            color: var(--primary);
            font-weight: 500;
        }

        .step.completed .step-label {
            color: var(--success);
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        /* Loading Indicator */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px 0;
        }

        .loader {
            width: 25px;
            height: 25px;
            border: 3px solid var(--light);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Sidebar Toggle Button */
        .sidebar-toggle {
            position: fixed;
            left: 20px;
            top: 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 101;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .sidebar-toggle:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .chat-area.with-sidebar {
                margin-left: 0;
            }
            
            .chat-history {
                width: 85%;
                transform: translateX(-100%);
            }
            
            .chat-history.active {
                transform: translateX(0);
            }
            
            .modal {
                width: 95%;
            }
            
            .therapist-profile {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .therapist-profile-info {
                text-align: center;
            }
            
            .therapist-profile-rating {
                justify-content: center;
            }
            
            .therapist-specialties {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .message {
                max-width: 90%;
            }
            
            .payment-method {
                min-width: calc(50% - 10px);
            }
            
            .therapist-card {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .therapist-avatar {
                margin-right: 0;
                margin-bottom: 10px;
            }
        }

        @media (max-width: 576px) {
            .payment-method {
                min-width: 100%;
            }
            
            .step-label {
                font-size: 0.7rem;
            }
            
            .modal-body {
                padding: 15px;
            }
            
            .therapist-profile-img {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>

    <!-- Header with Navigation -->
    <header class="header">
        <a href="#" class="logo">
            <i class="fas fa-brain"></i>
            SerenityQ
        </a>
        
        <div class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
        
        <nav class="navbar" id="navbar">
            <ul class="nav-links">
                <li><a href="ai.html" class="nav-link active"><i class="fas fa-robot"></i> SerenityQ AI</a></li>
                <li><a href="dashboard.html" class="nav-link"><i class="fas fa-home"></i> Statistics</a></li>
                <li><a href="appointment.html" class="nav-link"><i class="fas fa-calendar-alt"></i> Appointments</a></li>
                <li><a href="therapist.html" class="nav-link"><i class="fas fa-user-md"></i> Therapists</a></li>
                <li><a href="booking-history.html" class="nav-link"><i class="fas fa-history"></i> Booking History</a></li>
                <li><a href="sessions.html" class="nav-link"><i class="fas fa-clock"></i> Sessions</a></li>
            </ul>
            
            <div class="profile">
                <span class="profile-name">Sarah</span>
                <img src="https://randomuser.me/api/portraits/women/45.jpg" class="profile-img" alt="Profile">
                <div class="dropdown-menu">
                    <a href="user-profile.html" class="dropdown-item"><i class="fas fa-user"></i> Profile</a>
                    <a href="notifications.html" class="dropdown-item"><i class="fas fa-bell"></i> Notifications</a>
                    <div class="divider"></div>
                    <a href="#" class="dropdown-item"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Main Chat Container -->
    <div class="chat-container">
        <!-- Chat History Sidebar -->
        <div class="chat-history" id="chatHistory">
            <div class="chat-history-header">
                <span>SerenityQ AI</span>
                <i class="fas fa-cog"></i>
            </div>
            <button class="new-chat-btn" id="newChatBtn">
                <i class="fas fa-plus"></i> New Chat
            </button>
            <div class="history-title">Recent Chats</div>
            <div class="history-list" id="historyList">
                <!-- Chat history items will be added here dynamically -->
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chat-area" id="chatArea">
            <div class="chat-messages" id="chatMessages">
                <!-- AI Welcome Message -->
                <div class="message ai-message">
                    <div class="message-content">
                        <p>Hello! I'm SerenityQ AI. I can help you find the perfect psychologist based on your needs. What symptoms or concerns would you like to discuss?</p>
                        <div class="message-time">Just now</div>
                    </div>
                </div>
            </div>

            <!-- User Input Area -->
            <div class="user-input-container">
                <div class="user-input-box">
                    <textarea id="userMessage" placeholder="Type your message here..." rows="1"></textarea>
                    <button class="send-btn" id="sendMessageBtn"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Therapist Modal -->
    <div class="modal-overlay" id="therapistModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Therapist Details</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be loaded here -->
            </div>
        </div>
    </div>

    <script src="js/activeLink.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const chatMessages = document.getElementById('chatMessages');
            const userMessageInput = document.getElementById('userMessage');
            const sendMessageBtn = document.getElementById('sendMessageBtn');
            const newChatBtn = document.getElementById('newChatBtn');
            const historyList = document.getElementById('historyList');
            const menuToggle = document.getElementById('menuToggle');
            const navbar = document.getElementById('navbar');
            const therapistModal = document.getElementById('therapistModal');
            const modalClose = document.getElementById('modalClose');
            const modalBody = document.getElementById('modalBody');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const chatHistory = document.getElementById('chatHistory');
            const chatArea = document.getElementById('chatArea');
            
            // Conversation state
            let currentChatId = Date.now();
            let conversationState = {
                step: 1, // 1: initial, 2: symptoms, 3: preferences, 4: price range, 5: show results
                symptoms: '',
                preferences: '',
                priceRange: ''
            };
            
            // Sample therapist data
            const therapists = [
                {
                    id: 1,
                    name: "Dr. Sarah Johnson",
                    specialty: "Clinical Psychologist",
                    rating: 4.7,
                    reviews: 128,
                    price: 120,
                    image: "https://randomuser.me/api/portraits/women/65.jpg",
                    about: "Specializes in anxiety and depression with 10+ years experience. Dr. Johnson uses a combination of cognitive behavioral therapy and mindfulness techniques to help clients manage their symptoms and improve their quality of life.",
                    specialties: ["Anxiety", "Depression", "Stress Management", "Relationship Issues"],
                    languages: ["English", "Spanish"],
                    experience: "10 years",
                    approach: "Cognitive Behavioral Therapy, Mindfulness-Based"
                },
                {
                    id: 2,
                    name: "Dr. Michael Chen",
                    specialty: "Cognitive Behavioral Therapist",
                    rating: 4.9,
                    reviews: 95,
                    price: 150,
                    image: "https://randomuser.me/api/portraits/men/32.jpg",
                    about: "Expert in CBT for anxiety disorders and workplace stress. Dr. Chen has helped numerous clients overcome phobias, OCD, and work-related stress through evidence-based techniques.",
                    specialties: ["Anxiety Disorders", "OCD", "Mindfulness", "Workplace Stress"],
                    languages: ["English", "Mandarin"],
                    experience: "8 years",
                    approach: "Cognitive Behavioral Therapy, Exposure Therapy"
                },
                {
                    id: 3,
                    name: "Dr. Emily Wilson",
                    specialty: "Child Psychologist",
                    rating: 4.5,
                    reviews: 76,
                    price: 90,
                    image: "https://randomuser.me/api/portraits/women/44.jpg",
                    about: "Dedicated to helping children and adolescents with emotional challenges. Dr. Wilson creates a safe, playful environment for young clients to express themselves and develop coping skills.",
                    specialties: ["Child Psychology", "ADHD", "Family Therapy", "Adolescent Issues"],
                    languages: ["English"],
                    experience: "6 years",
                    approach: "Play Therapy, Family Systems Therapy"
                },
                {
                    id: 4,
                    name: "Dr. Robert Garcia",
                    specialty: "Trauma Specialist",
                    rating: 4.8,
                    reviews: 112,
                    price: 180,
                    image: "https://randomuser.me/api/portraits/men/45.jpg",
                    about: "Specializes in trauma recovery and PTSD treatment. Dr. Garcia uses EMDR and other trauma-focused therapies to help clients process and heal from traumatic experiences.",
                    specialties: ["PTSD", "Trauma Recovery", "EMDR", "Grief Counseling"],
                    languages: ["English", "Spanish"],
                    experience: "12 years",
                    approach: "EMDR, Trauma-Focused CBT"
                },
                {
                    id: 5,
                    name: "Dr. Priya Patel",
                    specialty: "Couples Therapist",
                    rating: 4.6,
                    reviews: 89,
                    price: 140,
                    image: "https://randomuser.me/api/portraits/women/68.jpg",
                    about: "Helps couples improve communication and resolve conflicts. Dr. Patel uses evidence-based approaches to help partners understand each other better and strengthen their relationships.",
                    specialties: ["Couples Therapy", "Marriage Counseling", "Communication Skills", "Family Conflict"],
                    languages: ["English", "Hindi"],
                    experience: "9 years",
                    approach: "Gottman Method, Emotionally Focused Therapy"
                }
            ];
            
            // Initialize with a default chat
            addToHistory(currentChatId, "New Chat");
            
            // Toggle mobile menu
            menuToggle.addEventListener('click', function() {
                navbar.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });
            
            // Toggle sidebar
            sidebarToggle.addEventListener('click', function() {
                chatHistory.classList.toggle('active');
                chatArea.classList.toggle('with-sidebar');
            });
            
            // Close modal
            modalClose.addEventListener('click', function() {
                therapistModal.classList.remove('active');
            });
            
            // Close modal when clicking outside
            therapistModal.addEventListener('click', function(e) {
                if (e.target === therapistModal) {
                    therapistModal.classList.remove('active');
                }
            });
            
            // Send message function
            function sendMessage() {
                const message = userMessageInput.value.trim();
                if (message === '') return;
                
                // Add user message to chat
                addMessage(message, 'user');
                userMessageInput.value = '';
                adjustTextareaHeight();
                
                // Process user input based on conversation state
                processAIResponse(message);
            }
            
            // Process AI response based on conversation state
            function processAIResponse(userMessage) {
                // Check for "next" or "another" to find another therapist
                if ((userMessage.toLowerCase().includes('next') || 
                     userMessage.toLowerCase().includes('another')) && 
                    conversationState.step === 4) {
                    setTimeout(() => {
                        showTherapistResults();
                    }, 800);
                    return;
                }
                
                switch(conversationState.step) {
                    case 1: // Initial symptoms
                        conversationState.symptoms = userMessage;
                        conversationState.step = 2;
                        setTimeout(() => {
                            addMessage("Thank you for sharing. What specific preferences do you have for your therapist? (e.g., gender, therapy approach, experience level)", 'ai');
                        }, 800);
                        break;
                        
                    case 2: // Preferences
                        conversationState.preferences = userMessage;
                        conversationState.step = 3;
                        setTimeout(() => {
                            addMessage("What is your preferred price range per session? (e.g., $50-$100, $100-$150, $150+)", 'ai');
                        }, 800);
                        break;
                        
                    case 3: // Price range
                        conversationState.priceRange = userMessage;
                        conversationState.step = 4;
                        setTimeout(() => {
                            addMessage("Great! I'll now search for psychologists that match your needs...", 'ai');
                            setTimeout(showTherapistResults, 1500);
                        }, 800);
                        break;
                        
                    case 4: // After showing results
                        setTimeout(() => {
                            addMessage("Would you like me to find another psychologist or do you have any other questions?", 'ai');
                        }, 800);
                        break;
                        
                    default:
                        setTimeout(() => {
                            addMessage("I'm not sure how to respond to that. Could you please rephrase?", 'ai');
                        }, 800);
                }
            }
            
            // Show therapist results
            function showTherapistResults() {
                // Show loading indicator
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'message ai-message';
                loadingDiv.innerHTML = `
                    <div class="message-content">
                        <div class="loading">
                            <div class="loader"></div>
                            <span>Searching for therapists...</span>
                        </div>
                    </div>
                `;
                chatMessages.appendChild(loadingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Simulate API delay
                setTimeout(() => {
                    // Remove loading indicator
                    chatMessages.removeChild(loadingDiv);
                    
                    // Filter therapists based on user preferences (simplified for demo)
                    const filteredTherapists = therapists.filter(therapist => {
                        return therapist.price <= getMaxPrice(conversationState.priceRange);
                    });
                    
                    if (filteredTherapists.length === 0) {
                        addMessage("No therapists found matching your criteria. Try adjusting your preferences.", 'ai');
                        return;
                    }
                    
                    // Pick one random therapist from filtered list
                    const selectedTherapist = filteredTherapists[Math.floor(Math.random() * filteredTherapists.length)];
                    
                    // Add therapist card to chat
                    const therapistCard = document.createElement('div');
                    therapistCard.className = 'therapist-card';
                    therapistCard.innerHTML = `
                        <div class="therapist-avatar">
                            <img src="${selectedTherapist.image}" alt="${selectedTherapist.name}">
                        </div>
                        <div class="therapist-info">
                            <h4>${selectedTherapist.name}</h4>
                            <div class="specialty">${selectedTherapist.specialty}</div>
                            <div class="rating">
                                ${generateStars(selectedTherapist.rating)}
                                <span>${selectedTherapist.rating} (${selectedTherapist.reviews} reviews)</span>
                            </div>
                            <div class="price">$${selectedTherapist.price} per session</div>
                        </div>
                    `;
                    
                    // Add click event to view therapist details
                    therapistCard.addEventListener('click', function() {
                        showTherapistModal(selectedTherapist);
                    });
                    
                    // Create AI message container
                    const aiMessage = document.createElement('div');
                    aiMessage.className = 'message ai-message';
                    
                    const messageContent = document.createElement('div');
                    messageContent.className = 'message-content';
                    messageContent.innerHTML = `
                        <p>Here's a psychologist I found that matches your needs:</p>
                        <div class="therapist-cards"></div>
                        <p>Click on the profile to view details and book a session.</p>
                    `;
                    
                    messageContent.querySelector('.therapist-cards').appendChild(therapistCard);
                    aiMessage.appendChild(messageContent);
                    chatMessages.appendChild(aiMessage);
                    
                    // Scroll to bottom
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 2000);
            }
            
            // Show therapist modal with details
            function showTherapistModal(therapist) {
                modalBody.innerHTML = `
                    <div class="therapist-profile">
                        <img src="${therapist.image}" alt="${therapist.name}" class="therapist-profile-img">
                        <div class="therapist-profile-info">
                            <h3>${therapist.name}</h3>
                            <div class="therapist-profile-specialty">${therapist.specialty}</div>
                            <div class="therapist-profile-rating">
                                ${generateStars(therapist.rating)}
                                <span>${therapist.rating} (${therapist.reviews} reviews)</span>
                            </div>
                            <div class="therapist-profile-price">$${therapist.price} per session</div>
                        </div>
                    </div>
                    
                    <div class="therapist-profile-about">
                        <h4>About</h4>
                        <p>${therapist.about}</p>
                    </div>
                    
                    <div class="therapist-details">
                        <h4>Details</h4>
                        <p><strong>Experience:</strong> ${therapist.experience}</p>
                        <p><strong>Therapeutic Approach:</strong> ${therapist.approach}</p>
                        <p><strong>Languages:</strong> ${therapist.languages.join(', ')}</p>
                    </div>
                    
                    <div class="therapist-specialties">
                        <h4>Specialties</h4>
                        <div class="specialty-badges">
                            ${therapist.specialties.map(spec => `<span class="specialty-badge">${spec}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="booking-section" id="bookingSection">
                        <div class="booking-steps">
                            <div class="step active" data-step="1">
                                <div class="step-number">1</div>
                                <div class="step-label">Schedule</div>
                            </div>
                            <div class="step" data-step="2">
                                <div class="step-number">2</div>
                                <div class="step-label">Payment</div>
                            </div>
                            <div class="step" data-step="3">
                                <div class="step-number">3</div>
                                <div class="step-label">Confirm</div>
                            </div>
                        </div>
                        
                        <div class="step-content active" data-step="1">
                            <form id="bookingForm">
                                <div class="form-group">
                                    <label for="sessionDate">Session Date</label>
                                    <input type="date" id="sessionDate" class="form-control" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="sessionTime">Session Time</label>
                                    <select id="sessionTime" class="form-control" required>
                                        <option value="">Select a time</option>
                                        <option value="09:00">9:00 AM</option>
                                        <option value="10:00">10:00 AM</option>
                                        <option value="11:00">11:00 AM</option>
                                        <option value="13:00">1:00 PM</option>
                                        <option value="14:00">2:00 PM</option>
                                        <option value="15:00">3:00 PM</option>
                                        <option value="16:00">4:00 PM</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="sessionType">Session Type</label>
                                    <select id="sessionType" class="form-control" required>
                                        <option value="video">Video Call</option>
                                        <option value="phone">Phone Call</option>
                                        <option value="in-person">In-Person</option>
                                    </select>
                                </div>
                                
                                <div class="step-navigation">
                                    <button type="button" class="btn btn-outline" disabled>Back</button>
                                    <button type="button" class="btn btn-primary next-step">Next</button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="step-content" data-step="2">
                            <div class="form-group">
                                <label>Payment Method</label>
                                <div class="payment-methods">
                                    <div class="payment-method" data-method="credit">
                                        <i class="fab fa-cc-visa"></i>
                                        <div class="payment-method-info">
                                            <h5>Credit Card</h5>
                                            <p>Visa, Mastercard</p>
                                        </div>
                                    </div>
                                    <div class="payment-method" data-method="paypal">
                                        <i class="fab fa-paypal"></i>
                                        <div class="payment-method-info">
                                            <h5>PayPal</h5>
                                            <p>Secure payments</p>
                                        </div>
                                    </div>
                                    <div class="payment-method" data-method="gcash">
                                        <i class="fas fa-mobile-alt"></i>
                                        <div class="payment-method-info">
                                            <h5>GCash</h5>
                                            <p>Mobile payments</p>
                                        </div>
                                    </div>
                                    <div class="payment-method" data-method="maya">
                                        <i class="fas fa-wallet"></i>
                                        <div class="payment-method-info">
                                            <h5>Maya</h5>
                                            <p>Digital wallet</p>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="paymentMethod" value="credit">
                            </div>
                            
                            <div class="step-navigation">
                                <button type="button" class="btn btn-outline prev-step">Back</button>
                                <button type="button" class="btn btn-primary next-step">Next</button>
                            </div>
                        </div>
                        
                        <div class="step-content" data-step="3">
                            <div class="booking-summary">
                                <h4>Booking Summary</h4>
                                <div class="summary-item">
                                    <span>Therapist:</span>
                                    <strong>${therapist.name}</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Date & Time:</span>
                                    <strong id="summaryDateTime">Not selected</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Session Type:</span>
                                    <strong id="summarySessionType">Video Call</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Payment Method:</span>
                                    <strong id="summaryPaymentMethod">Credit Card</strong>
                                </div>
                                <div class="summary-item total">
                                    <span>Total:</span>
                                    <strong>$${therapist.price}</strong>
                                </div>
                            </div>
                            
                            <div class="step-navigation">
                                <button type="button" class="btn btn-outline prev-step">Back</button>
                                <button type="button" class="btn btn-primary confirm-booking">Confirm Booking</button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Set minimum date to tomorrow
                const dateInput = document.getElementById('sessionDate');
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                dateInput.min = tomorrow.toISOString().split('T')[0];
                
                // Payment method selection
                const paymentMethods = document.querySelectorAll('.payment-method');
                paymentMethods.forEach(method => {
                    method.addEventListener('click', function() {
                        paymentMethods.forEach(m => m.classList.remove('active'));
                        this.classList.add('active');
                        document.getElementById('paymentMethod').value = this.dataset.method;
                        document.getElementById('summaryPaymentMethod').textContent = 
                            this.querySelector('h5').textContent;
                    });
                });
                
                // Set first payment method as active by default
                paymentMethods[0].classList.add('active');
                
                // Step navigation
                const nextButtons = document.querySelectorAll('.next-step');
                const prevButtons = document.querySelectorAll('.prev-step');
                const steps = document.querySelectorAll('.step');
                const stepContents = document.querySelectorAll('.step-content');
                
                nextButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const currentStep = this.closest('.step-content').dataset.step;
                        const nextStep = parseInt(currentStep) + 1;
                        
                        // Update summary for step 3
                        if (nextStep === 3) {
                            const date = document.getElementById('sessionDate').value;
                            const time = document.getElementById('sessionTime').value;
                            const sessionType = document.getElementById('sessionType').value;
                            
                            if (date && time) {
                                const dateObj = new Date(`${date}T${time}`);
                                document.getElementById('summaryDateTime').textContent = 
                                    dateObj.toLocaleString('en-US', {
                                        weekday: 'short',
                                        month: 'short',
                                        day: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    });
                            }
                            
                            document.getElementById('summarySessionType').textContent = 
                                document.getElementById('sessionType').options[
                                    document.getElementById('sessionType').selectedIndex
                                ].text;
                        }
                        
                        navigateToStep(nextStep);
                    });
                });
                
                prevButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const currentStep = this.closest('.step-content').dataset.step;
                        const prevStep = parseInt(currentStep) - 1;
                        navigateToStep(prevStep);
                    });
                });
                
                // Confirm booking
                document.querySelector('.confirm-booking')?.addEventListener('click', function() {
                    completeBooking(therapist);
                });
                
                // Show modal
                therapistModal.classList.add('active');
                
                function navigateToStep(step) {
                    // Update steps
                    steps.forEach(stepEl => {
                        const stepNum = parseInt(stepEl.dataset.step);
                        if (stepNum < step) {
                            stepEl.classList.remove('active');
                            stepEl.classList.add('completed');
                        } else if (stepNum === step) {
                            stepEl.classList.add('active');
                            stepEl.classList.remove('completed');
                        } else {
                            stepEl.classList.remove('active', 'completed');
                        }
                    });
                    
                    // Update content
                    stepContents.forEach(content => {
                        if (content.dataset.step == step) {
                            content.classList.add('active');
                        } else {
                            content.classList.remove('active');
                        }
                    });
                }
            }
            
            // Complete booking process
            function completeBooking(therapist) {
                const bookingSection = document.getElementById('bookingSection');
                bookingSection.innerHTML = `
                    <div class="booking-success">
                        <i class="fas fa-check-circle"></i>
                        <h3>Booking Confirmed!</h3>
                        <p>Your session with ${therapist.name} has been successfully booked.</p>
                        <p>We've sent the details to your email.</p>
                        <button class="btn btn-outline" id="closeModal">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                `;
                
                document.getElementById('closeModal').addEventListener('click', function() {
                    therapistModal.classList.remove('active');
                    
                    // Add confirmation message to chat
                    addMessage(`I've booked a session with ${therapist.name} for you!`, 'ai');
                });
            }
            
            // Add message to chat
            function addMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}-message`;
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.innerHTML = `<p>${text}</p>`;
                
                // Add timestamp
                const now = new Date();
                const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                contentDiv.innerHTML += `<div class="message-time">${timeString}</div>`;
                
                messageDiv.appendChild(contentDiv);
                chatMessages.appendChild(messageDiv);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Add chat to history
            function addToHistory(id, previewText) {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.dataset.chatId = id;
                historyItem.innerHTML = `
                    <i class="fas fa-comment"></i>
                    <span class="history-item-text">${previewText}</span>
                `;
                
                historyItem.addEventListener('click', function() {
                    // In a real app, this would load the chat history
                    document.querySelectorAll('.history-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.classList.add('active');
                });
                
                historyList.insertBefore(historyItem, historyList.firstChild);
            }
            
            // Create new chat
            function createNewChat() {
                currentChatId = Date.now();
                chatMessages.innerHTML = `
                    <div class="message ai-message">
                        <div class="message-content">
                            <p>Hello! I'm SerenityQ AI. I can help you find the perfect psychologist based on your needs. What symptoms or concerns would you like to discuss?</p>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                `;
                
                conversationState = {
                    step: 1,
                    symptoms: '',
                    preferences: '',
                    priceRange: ''
                };
                
                addToHistory(currentChatId, "New Chat");
            }
            
            // Helper function to generate star rating
            function generateStars(rating) {
                let stars = '';
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                
                for (let i = 0; i < fullStars; i++) {
                    stars += '<i class="fas fa-star"></i>';
                }
                
                if (hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                }
                
                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
                for (let i = 0; i < emptyStars; i++) {
                    stars += '<i class="far fa-star"></i>';
                }
                
                return stars;
            }
            
            // Helper function to get max price from range
            function getMaxPrice(range) {
                if (!range) return 200; // default
                if (range.includes('+')) return 9999;
                const matches = range.match(/\$?(\d+)/g);
                if (matches && matches.length > 1) return parseInt(matches[1]);
                return 200; // default
            }
            
            // Adjust textarea height based on content
            function adjustTextareaHeight() {
                userMessageInput.style.height = 'auto';
                userMessageInput.style.height = (userMessageInput.scrollHeight) + 'px';
            }
            
            // Event listeners
            sendMessageBtn.addEventListener('click', sendMessage);
            newChatBtn.addEventListener('click', createNewChat);
            
            userMessageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            userMessageInput.addEventListener('input', adjustTextareaHeight);
            
            // Initialize textarea height
            adjustTextareaHeight();
        });
    </script>
</body>
</html> 